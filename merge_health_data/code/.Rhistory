temp_data <- fread("../data/temperature_data/temperature_daily_zipcode_combined.csv")
source('~/.active-rstudio-document', echo=TRUE)
temp_data[, date := ymd(date)]
out <- as.data.frame(expand.grid(unique(temp_data$ZIP), temp_data$year))
out <- as.data.table(expand.grid(unique(temp_data$ZIP), unique(temp_data$year)))
temp_data[date %within% interval(ymd("20120621"), ymd("20120921")),.(ZIP, year, mean(tmmx)), by = c("ZIP", "year")]
max(ymd("20120101"), ymd(20000101))
max(ymd("19991221"), ymd(20000101))
year_ <- 2006
summer_int <- interval(ymd(paste0(year_, "0621")), ymd(paste0(year_, "0921")))
summer_year <- temp_data[date %within% summer_int, .(summer_tmmx = mean(tmmx), summer_rmax = mean(rmax)), by = ZIP]
winter_int <- interval(max(ymd(paste0(year_,  "1221")), ymd("20000101")),  ymd(paste0(year_, "0321")))
winter_int
winter_int <- interval(max(ymd(paste0(year_ - 1,  "1221")), ymd("20000101")),  ymd(paste0(year_, "0321")))
winter_int
year_ <- 2000
winter_int <- interval(max(ymd(paste0(year_ - 1,  "1221")), ymd("20000101")),  ymd(paste0(year_, "0321")))
winter_int
winter_year <- temp_data[date %within% winter_int, .(winter_tmmx = mean(tmmx), winter_rmax = mean(rmax)), by = ZIP]
summer  <- NULL
winter <- NULL
for (year_ in 2000:2005) {
summer_int <- interval(ymd(paste0(year_, "0621")), ymd(paste0(year_, "0921")))
winter_int <- interval(max(ymd(paste0(year_ - 1,  "1221")), ymd("20000101")),  ymd(paste0(year_, "0321")))
summer_year <- temp_data[date %within% summer_int, .(summer_tmmx = mean(tmmx), summer_rmax = mean(rmax)), by = ZIP]
summer_year[, year := year_]
summer <- rbind(summer, summer_year)
winter_year <- temp_data[date %within% winter_int, .(winter_tmmx = mean(tmmx), winter_rmax = mean(rmax)), by = ZIP]
winter_year[, year := year_]
winter <- rbind(winter, winter_year)
}
out <- merge(summer, winter, by = c("ZIP", "year"))
setkey(summer_year, ZIP)
leap_year(2000)
leap_year(2001)
source('/nfs/nsaph_ci3/users/ci3_mbsabath/data_requests/request_projects/nov2019_seasonal_temperature/code/1_calculate_seasonal_averages.R', echo=TRUE)
format(Sys.Date(), %B)
format(Sys.Date(), "%B")
format(Sys.Date(), "%B %d, %y")
format(Sys.Date(), "%B %d, %Y")
format(Sys.Date(), "%B %D, %Y")
summary(out)
source('/nfs/nsaph_ci3/users/ci3_mbsabath/data_requests/request_projects/nov2019_seasonal_temperature/code/1_calculate_seasonal_averages.R', echo=TRUE)
41540 * 17
library(rmarkdown)
render("../readme.Rmd", output_format = github_document())
setwd("../..")
setwd("../request_projects/exp_covar_health_merge_2016_april2019/code/")
seasonal_data <- fread("../data/confounder_data/earth_engine/temperature/temperature_seasonal_zipcode_combined.csv")
names(seasonal_data) <- tolower(names(seasonal_data))
seasonal_data[, zip := int_to_zip_str(zip)]
summary(seasonal_data)
cache_dir <- "../data/merge_cache/"
file <- list.files(cache_dir, pattern = ".fst", full.names = T)[1]
file <- list.files(cache_dir, pattern = ".fst", full.names = T)[3]
file
x <- read.fst(file, as.data.table = T)
library(fst)
x <- read.fst(file, as.data.table = T)
nrow(x)
x <- merge(x, seasonal_data, all.x = T, by = c("zip", "year"))
seasonal_data <- fread("../data/confounder_data/earth_engine/temperature/temperature_seasonal_zipcode_combined.csv")
names(seasonal_data) <- tolower(names(seasonal_data))
x <- merge(x, seasonal_data, all.x = T, by = c("zip", "year"))
nrow(x)
summary(x)
source('/nfs/nsaph_ci3/users/ci3_mbsabath/data_requests/request_projects/exp_covar_health_merge_2016_april2019/code/10_merge_seasonal_temperature.R', echo=TRUE)
